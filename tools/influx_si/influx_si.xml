<tool id="influx_si" name="influx_si" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="21.09">
    <description>
        Estimate metabolic fluxes and concentrations by fitting simulated labeling in metabolites to NMR/MS measurements
    </description>
    <creator>
        <person givenName="Serguei" familyName="Sokol" email="sokol@insa-toulouse.fr" url="https://www.toulouse-biotechnology-institute.fr/en/plateformes-plateaux/cellule-mathematiques/" />
        <organization name="INRAE" url="https://www.inrae.fr/" />
        <organization name="TBI" url="https://www.toulouse-biotechnology-institute.fr/" />
        <organization name="Mathematics Cell" url="https://www.toulouse-biotechnology-institute.fr/en/plateformes-plateaux/cellule-mathematiques/" />
        <organization name="MetaToul-FluxoMet" url="https://www.toulouse-biotechnology-institute.fr/en/plateformes-plateaux/metatoul/" />
        <organization name="MetaboHub2" url="https://www.metabohub.fr/" />
    </creator>
    <macros>
        <import>macros.xml</import>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">influx_si</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        #for $inp in $input_main:
            unzip $inp;
        #end for
               
        ret=0;
        influx_$si.s_i
            @COMMAND_OPT@
            #if $si.s_i == 'i' and $si.time_order != 'None':
              --time_order='$si.time_order'
            #end if
            #for $inp in $input_main:
                #set base = $inp.name[:-4]
                --prefix "$base"
            #end for
            @MTF_OPT@
            || ret=\$?;

        #for $inp in $input_main:
            #set base = $inp.name[:-4]
            for f in "$base"_res/*.{err,log}; do mv -f "\$f" "\$f".txt || true; done;
            for f in "$base"_res/*.{sim,stat}; do mv -f "\$f" "\$f".tsv || true; done;
            for f in "$base"_res/*.pdf; do [ -e "\$f" ] && mv -f "\$f" "\$f".pdf || true; done;
            rm -rf "$base"_res/tmp || true;
        #end for
        exit \$ret;
    ]]></command>
    <expand macro="inputs" />
    <outputs>
        <collection name="influx_si_output" type="list:list" label="influx_${si.s_i}_on_${on_string}" format="auto">
            <discover_datasets match_relative_path="true" recurse="true" pattern="(?P&lt;identifier_0&gt;[^/]+)_res/(?P&lt;identifier_1&gt;[^/]+)\.(?P&lt;file_ext&gt;[^.]+)" visible="false"/>
        </collection>
    </outputs>
    <tests>
        <test>
            <param name="input_main" value="e_coli.zip" />
            <conditional name="si">
                <param name="s_i" value="s" />
            </conditional>
            <output_collection name="influx_si_output" type="list:list" count="1">
                <element name="e_coli" count="7">
                    <element name="e_coli.log">
                        <assert_contents>
                            <has_n_lines n="38"/>
                            <has_line_matching expression="^end.*"/>
                        </assert_contents>
                    </element>
                </element>
            </output_collection>
        </test>
    </tests>
    <expand macro="help" />
    <expand macro="citation" />
</tool>
